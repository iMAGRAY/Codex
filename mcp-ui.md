# Codex CLI MCP Configuration UX Blueprint — Formal Iteration 2

## 0. Пролог
Этот документ фиксирует полномасштабный обзор пользовательского опыта настройки MCP-серверов в Codex CLI. Цель — довести UX до состояния «нулевой когнитивной нагрузки» при строгом соблюдении политик безопасности OpenAI. В данной итерации:
- проведено дополнительное исследование из 100 альтернатив предельного качества с формальной критикой;
- выполнен диалогический анализ каждым из решений двумя «суровыми циниками» для выявления скрытых рисков;
- сформирован революционный концепт **“MCP Atlas Autopilot v2”**, детализированный до уровня операционного плана, совместимого с корпоративными стандартами.

## 1. Цели и критерии успеха
1. **Zero-Friction Intake:** ≥ 95% типовых MCP-источников превращаются в готовый `McpServerConfig` без ручного редактирования, при этом пользователь принимает ≤ 3 фокусных решения.
2. **Нулевая когнитивная нагрузка:** каждый экран TUI/CLI содержит не более двух активных действий; все значения снабжены reason code, источником и объяснением.
3. **Безопасность:** никакой код из источника не выполняется без подтверждённого opt-in; sandbox запускается с ограничением CPU/IO и журналированием, временные артефакты удаляются автоматически (TTL ≤ 24 ч).
4. **Производительность:** первичный анализ каталога ≤ 200 файлов занимает p95 ≤ 400 мс (macOS/Linux) и ≤ 650 мс (Windows). Повтор с кешом ≤ 120 мс.
5. **Консистентность и аудит:** CLI и TUI используют единый движок `codex_core::mcp::intake`; каждый автоматический выбор сопровождается reason code и попадает в лог действий.
6. **Доступность:** интерфейс доступен клавиатурой, совместим со screen reader, выдерживает контраст ≥ 7:1, поддерживает i18n.

## 2. Ограничения и инварианты
- Read-only анализ источника; временные файлы создаются в изолированном каталоге `~/.codex/tmp/mcp-intake/<hash>` и автоматически удаляются.
- Запуск health-check возможен только после явного согласия пользователя; выполняется в платформенно-специфичном sandbox (bubblewrap/nsjail/job objects) с лимитом CPU ≤ 60%, RAM ≤ 512 MB, wall time ≤ 5 с.
- Никакой сети без явного разрешения пользователя (поддерживается политика zero-egress).
- Reason code каталог подписывается через Trusted Pipeline; knowledge packs обновляются с верификацией подписи.
- Snapshot-отчёты и логи видимы только локально, имеют TTL 24 ч, автоматически удаляются в ZDR-режиме.

## 3. Консолидированный пакет решений
Концентрация на наиболее реализуемых и безопасных шагах снижает когнитивную нагрузку и удерживает проект в границах метрик из раздела 1. Ниже приведён curated-набор, который ляжет в основу дорожной карты и ежедневной работы команд. 100 исследованных альтернатив перенесены в **Приложение A** и остаются доступными для расширений.

### 3.1 Intake & Signals
| ID | Решение | Назначение | Ключевая метрика | Ключевые зависимости | Спринт |
| --- | --- | --- | --- | --- | --- |
| A1 | Adaptive Source Parser | Универсальный ввод (каталог/архив/manifest/clipboard) без ручного переключения режимов | Zero-Friction Intake (p95 ≤ 400 мс) | Intake Engine Normalizer | Foundation |
| A2 | Trusted Source Fingerprint | Отслеживание дрейфа источника и безопасное кеширование подсказок | Zero-Friction Intake | Fingerprint Store, Reason Codes | Foundation |
| A5 | Source Preview Strip | Контекст ключевых файлов и предупреждений до подтверждения | Нулевая когнитивная нагрузка | TUI Wizard View, Chatwidget bridge | Insight |
| A7 | Policy-Aware Source Guard | Немедленные предупреждения о запрещённых путях/артефактах | Безопасность | Policy Guard Catalog | Foundation |
| A9 | Offline Archive Integrity Check | Проверка целостности zip/tar в офлайне | Безопасность | Intake Temp Workspace | Safety |
| B1 | Modular Detector Registry | Горячее подключение детекторов через подписанные пакеты | Консистентность и аудит | Detector Loader, Reason Catalog | Foundation |
| B2 | Weighted Confidence Scoring | Прозрачная формула уверенности и объяснения | Нулевая когнитивная нагрузка | Detector outputs, Reason Codes | Insight |
| B4 | Intent Conflict Resolver | Разрешение конфликтов подсказок перед финализацией | Zero-Friction Intake | Detector Registry, UX prompts | Insight |
| B6 | Dependency Footprint Estimator | Раннее предупреждение о тяжёлых зависимостях | Производительность | FS Scanner, Warmup Scheduler | Performance |

### 3.2 Insight & UX Flow
| ID | Решение | Назначение | Ключевая метрика | Ключевые зависимости | Спринт |
| --- | --- | --- | --- | --- | --- |
| C1 | Insight Canvas Grid | Главная таблица «Поле → предложение → увереность → причина» | Нулевая когнитивная нагрузка | Ratatui Layout, Stylize helpers | Insight |
| C2 | Progressive Disclosure Toggle | Скрывает advanced детали до запроса | Нулевая когнитивная нагрузка | Hotkeys map, Canvas Grid | Insight |
| C5 | Undo/Redo Stack | Безопасные эксперименты без потери подсказок | Нулевая когнитивная нагрузка | State Store, Command Router | Insight |
| C7 | Golden Path Footer | Контекстные «следующий шаг» ≤2 действия | Нулевая когнитивная нагрузка | UX Coach, Hotkeys | Insight |
| C8 | Inline Risk Alerts | Подсветка политик и рисков в строке | Безопасность | Policy Catalog, Canvas Grid | Insight |

### 3.3 Security & Governance
| ID | Решение | Назначение | Ключевая метрика | Ключевые зависимости | Спринт |
| --- | --- | --- | --- | --- | --- |
| D1 | Sandbox Consent Banner | Чёткое согласие перед запуском sandbox | Безопасность | Sandbox Runner, Audit Trail | Safety |
| D3 | Secret Scrubber | Автозамена секретов на placeholders | Безопасность | Policy Catalog, Diff Engine | Safety |
| D5 | Restricted Capability Warning | Блокировка автоприменения при запрещённом egress | Безопасность | Policy Guard, Capability Matrix | Safety |
| D7 | Signed Knowledge Packs | Supply-chain защита детекторов/подсказок | Безопасность | Trusted Pipeline, Key Rotation | Safety |
| D8 | Compliance Pre-flight Report | Краткий отчёт о соблюдении политик перед запуском | Консистентность и аудит | Evidence Log, Reason Codes | Safety |

### 3.4 Support & Debug Experience
| ID | Решение | Назначение | Ключевая метрика | Ключевые зависимости | Спринт |
| --- | --- | --- | --- | --- | --- |
| E1 | Debug Checklist Orchestrator | Автоматизированный набор проверок «файлы→deps→env» | Debug Resolution Rate | Detector Registry, Reason Codes | Support |
| E3 | Live Error Annotation | Подсветка stderr и быстрые советы | Debug Resolution Rate | Failure Pattern Library, Canvas Grid | Support |
| E6 | Replay Sandbox Button | Повторный запуск в пределах consent window | Debug Resolution Rate | Sandbox Runner, Consent Audit | Support |
| E8 | Guided Manual Fix Wizard | Структурированный fallback при низком confidence | Debug Resolution Rate | Undo/Redo, Confidence Model | Support |

### 3.5 Performance & Resilience
| ID | Решение | Назначение | Ключевая метрика | Ключевые зависимости | Спринт |
| --- | --- | --- | --- | --- | --- |
| F1 | Signal Cache Layer | Повторные сканы ≤120 мс за счёт кеша | Производительность | Fingerprint Store, Detector Registry | Performance |
| F3 | Adaptive Throttling | Баланс I/O под скорость диска | Производительность | Parallel Scanner, Perf Probe | Performance |
| F6 | Parallel FS Scanner | Распараллеленный анализ каталогов | Производительность | Warmup Scheduler, Adaptive Throttling | Performance |
| F8 | Low-end Mode Toggle | Минимум визуальных эффектов на слабых системах | Доступность/Производительность | UX Config, Feature Flags | Performance |

### 3.6 Collaboration & Review
| ID | Решение | Назначение | Ключевая метрика | Ключевые зависимости | Спринт |
| --- | --- | --- | --- | --- | --- |
| G1 | Reviewer Snapshot Export | Быстрая выгрузка состояния Intake | Review Effort ↓ | Snapshot Engine, Reason Codes | Collaboration |
| G3 | Change Justification Summary | Авто-сводка «что и почему изменилось» | Review Effort ↓ | Insight Canvas, Evidence Log | Collaboration |
| G5 | Reviewer Diff Mode in TUI | Дифф предложений и ручных правок | Review Effort ↓ | TUI Diff Component, Undo/Redo | Collaboration |

### 3.7 Accessibility & i18n
| ID | Решение | Назначение | Ключевая метрика | Ключевые зависимости | Спринт |
| --- | --- | --- | --- | --- | --- |
| H1 | Text-Only Mirror View | Поток, полностью совместимый со screen reader | Accessibility Score ≥ 0.95 | TUI Layout Mirror, AccessKit | Accessibility |
| H2 | AccessKit Bridge Layer | Структурная интеграция с assistive tech | Accessibility Score | AccessKit Adapter, Kernel API | Accessibility |
| H3 | i18n Key Map (`mcp_atlas.*`) | Централизованная локализация строк | Глобальная готовность | Localization Pipeline | Accessibility |
| H5 | Keyboard-First Navigation Map | Карта клавиш по `?` и тесты навигации | Accessibility Score | Hotkeys map, Documentation | Accessibility |

### 3.8 Integrations & Operations
| ID | Решение | Назначение | Ключевая метрика | Ключевые зависимости | Спринт |
| --- | --- | --- | --- | --- | --- |
| I1 | API Hooks for CI | Экспорт статуса intake в CI pipelines | Operational Efficiency | CLI Bridge, JSON schema | Integration |
| I2 | MCP Registry Sync | Авто-обновление каталога MCP (локально подписано) | Adoption Rate | Registry Client, Signed Packs | Integration |
| I5 | Knowledge Pack Auto-Update Scheduler | Плановая проверка и откат подписанных паков | Безопасность/Доступность | Trusted Pipeline, Scheduler | Integration |
| I8 | Metrics Bridge (local) | Локальный Prometheus endpoint без egress | Monitoring Coverage | Metrics Adapter, Perf Probe | Performance |
| J2 | Heartbeat Self-test | Периодическая самопроверка CLI/TUI | SLA Guardrail | Diagnostics Engine, Feature Flags | Stabilization |
| J4 | Stability Guard (feature flags) | Управляемый rollout и отключение модулей | SLA Guardrail | Feature Flag Service, Telemetry-free metrics | Stabilization |
| J9 | SLA Guardrail Alerts | Локальные оповещения о деградации метрик | SLA Guardrail | Metrics Bridge, Policy Notifier | Stabilization |

### 3.9 Связь с метриками и бэклогом
- Пол Coverage: каждое целевое значение из раздела 1 закрывается минимум двумя инициативами (например, Zero-Friction Intake → A1/A2/B2/F1, Нулевая когнитивная нагрузка → C1/C2/C5/C7, Безопасность → A7/D-секция, Производительность → F-секция, Консистентность и аудит → D8/G3).
- Спринты из `todo.md` напрямую сопоставляются с блоками 3.1–3.8; отметки статусов ведутся в `todo.md` (см. раздел 2 документа).
- Governance: каждый элемент имеет привязку к Reason Codes и Trusted Pipeline, что обеспечивает аудит и воспроизводимость.

## Приложение A. Исследование: 100 альтернативных решений
Альтернативы разбиты на 10 тематических блоков. Для каждого указаны механизм, ценность, риски, соответствие governance, диалог «двух циников» и вывод.

### Блок A. Источники и ввод (10 идей)

#### A1. Adaptive Source Parser
- **Механизм:** единый парсер, распознающий папки, zip/tar, manifest, clipboard-пути; выделяет тип источника до запуска анализа.
- **Ценность:** исключает многократный ввод, снижает ошибки путей.
- **Риски:** сложность поддержки разных файловых систем.
- **Governance:** соответствует read-only политике; требует валидации path traversal.
- **Ц1:** «Будем бороться с экзотическими путями до конца дней.»
- **Ц2:** «Цена оправдана — один ввод против пяти.»
- **Вердикт:** включить в базу (High impact, Medium cost).

#### A2. Trusted Source Fingerprint
- **Механизм:** создаёт SHA256-фингерпринт источника + timestamp; позволяет предупреждать о повторном анализе и дрейфе.
- **Ценность:** повышает уверенность, ускоряет повторные сканы.
- **Риски:** хранение хэшей нужно контролировать (TTL).
- **Governance:** совместимо с ZDR при TTL ≤ 24 ч.
- **Ц1:** «Хэшируем всё подряд — а потом что?»
- **Ц2:** «Потом экономим время и объясняем, когда конфиг устарел.»
- **Вердикт:** включить условно (нужен TTL и opt-out).

#### A3. Source Intent Profiler
- **Механизм:** определяет тип сервера (API, data fetcher, automation) по структуре файлов и ключевым словам.
- **Ценность:** подстраивает рекомендации и health-check.
- **Риски:** ложная классификация.
- **Governance:** не нарушает политики, если не запускает код.
- **Ц1:** «Ошибемся — и все подсказки насмарку.»
- **Ц2:** «С confidence и fallback ничего страшного.»
- **Вердикт:** включить, при confidence <0.6 показывать предупреждение.

#### A4. Clipboard Smart Suggestion
- **Механизм:** если в буфере путь/архив, UI предлагает использовать его.
- **Ценность:** экономит шаг.
- **Риски:** случайно «подглядим» приватный текст.
- **Governance:** требуется явное подтверждение и соблюдение ZDR.
- **Ц1:** «Не лезь в буфер — приватность.»
- **Ц2:** «Спрашиваем – «Использовать /path?» – и всё честно.»
- **Вердикт:** включить с confirm-попапом.

#### A5. Source Preview Strip
- **Механизм:** боковая панель показывает ключевые файлы найденного источника (README, manifest, main script).
- **Ценность:** прозрачность перед анализом.
- **Риски:** занимают место; нужно учитывать screen reader.
- **Governance:** нет ограничений.
- **Ц1:** «Превью — ещё один скролл в TUI.»
- **Ц2:** «Но пользователю важно видеть, что нашли.»
- **Вердикт:** включить с возможностью свернуть.

#### A6. Macro Shortcuts (`:recent`, `:temp`)
- **Механизм:** макросы в строке ввода разворачиваются в реальные пути.
- **Ценность:** ускоряет повторные операции.
- **Риски:** непрозрачность для новичков.
- **Governance:** безопасно при отображении раскрытого пути.
- **Ц1:** «Синтаксис запутает.»
- **Ц2:** «Добавим подсказку ниже строки.»
- **Вердикт:** включить с автоподсказкой.

#### A7. Policy-Aware Source Guard
- **Механизм:** проверяет источник против корпоративных правил (запрещённые директории, размеры).
- **Ценность:** соблюдение governance до анализа.
- **Риски:** нужна интеграция с policy store.
- **Governance:** строго в пределах политики.
- **Ц1:** «Политика опять всё тормозит.»
- **Ц2:** «Лучше отказ заранее, чем инцидент.»
- **Вердикт:** включить, если доступен policy endpoint.

#### A8. Guided Path Correction
- **Механизм:** при опечатке предлагает ближайшие совпадения.
- **Ценность:** снижает ошибки.
- **Риски:** может предложить неверный путь.
- **Governance:** требуется осторожность с отображением приватных путей.
- **Ц1:** «Сколько можно подсказывать? пусть внимательнее вводят.»
- **Ц2:** «Эргономика важнее, главное – скрывать приватные ветки.»
- **Вердикт:** включить с ограничением на глубину подсказок.

#### A9. Offline Archive Integrity Check
- **Механизм:** проверяет zip/tar на повреждения и уязвимости (zip bomb) до распаковки.
- **Ценность:** защищает pipeline.
- **Риски:** дополнительные вычисления.
- **Governance:** соответствует security политикам.
- **Ц1:** «Значит intake будет дольше.»
- **Ц2:** «Лучше потратить 50 мс, чем поймать zip-бомбу.»
- **Вердикт:** включить обязательно.

#### A10. Source Provenance Tagging
- **Механизм:** хранит «кто/когда» подключил источник (локально).
- **Ценность:** помогает командам координироваться.
- **Риски:** нужно соблюдать ZDR; не коммитить метаданные.
- **Governance:** локально, TTL → ок.
- **Ц1:** «Каждое действие в историю?»
- **Ц2:** «Да, если хранить сутки и чистить.»
- **Вердикт:** включить с TTL=24 ч.

### Блок B. Детекторы и анализ (10 идей)

#### B1. Modular Detector Registry
- **Механизм:** загрузка детекторов как подписанных knowledge packs.
- **Ценность:** расширяемость без изменения ядра.
- **Риски:** управление версиями.
- **Governance:** требует подписи, pipeline контроля.
- **Ц1:** «Пакеты ещё обновлять надо.»
- **Ц2:** «Но иначе не поддержим экосистему.»
- **Вердикт:** включить, управлять через Trusted Pipeline.

#### B2. Weighted Confidence Scoring
- **Механизм:** комбинация весов (manifest > script > README) с decay по возрасту файлов.
- **Ценность:** точные рекомендации.
- **Риски:** сложность калибровки.
- **Governance:** прозрачно при публикации формулы.
- **Ц1:** «Весы настроим — и забудем, пока всё не рухнет.»
- **Ц2:** «Автотесты на fixtures удержат в тонусе.»
- **Вердикт:** включить, документировать формулу.

#### B3. Language Runtime Signatures
- **Механизм:** определяет Node/Python/Go/Rust по структуре и файлам.
- **Ценность:** точечные подсказки и health-check.
- **Риски:** поддержка новых языков.
- **Governance:** ок, если без исполнения.
- **Ц1:** «Язык-клонов станет больше.»
- **Ц2:** «Пакеты обновляем вместе с registry.»
- **Вердикт:** включить.

#### B4. Intent Conflict Resolver
- **Механизм:** если детекторы дают разные intent, запускает автоматическое голосование и спрашивает пользователя.
- **Ценность:** избегает скрытых конфликтов.
- **Риски:** дополнительный шаг.
- **Governance:** прозрачность ↑.
- **Ц1:** «Ещё один диалог? утомит.»
- **Ц2:** «Только при конфликте; редкий случай.»
- **Вердикт:** включить с lazy-вызовом.

#### B5. Semantic README Miner
- **Механизм:** парсит README на команды/порты/зависимости (регекс+NLP-lite).
- **Ценность:** спасает проекты без manifest.
- **Риски:** false positive.
- **Governance:** не нарушает политик.
- **Ц1:** «README с мемами — данные ни о чём.»
- **Ц2:** «Confidence <0.5 → только подсказка.»
- **Вердикт:** включить с низким весом.

#### B6. Dependency Footprint Estimator
- **Механизм:** оценивает размер зависимостей (node_modules, venv).
- **Ценность:** предупреждает о тяжёлых серверах.
- **Риски:** дополнительная дисковая операция.
- **Governance:** учитывает security (бинарники).
- **Ц1:** «Снова считать мегабайты?»
- **Ц2:** «Одно чтение каталога — не критично.»
- **Вердикт:** включить для отчёта.

#### B7. External Service Identifier
- **Механизм:** по env/конфигам определяет, требует ли MCP внешние API.
- **Ценность:** помогает Security и пользователю.
- **Риски:** false positive.
- **Governance:** важно предупреждать о egress.
- **Ц1:** «Опять будем видеть фантомные API.»
- **Ц2:** «Если Confidence низкий — просто предупреждение.»
- **Вердикт:** включить с указанием Confidence.

#### B8. Policy Compliance Detector
- **Механизм:** проверяет параметры (порты, пути) против корпоративных правил.
- **Ценность:** автоматический аудит.
- **Риски:** зависимости от policy backend.
- **Governance:** обязательный элемент для enterprise.
- **Ц1:** «Политика меняется, мы не успеем.»
- **Ц2:** «Endpoint policy version — и обновляем автоматически.»
- **Вердикт:** включить.

#### B9. Drift Awareness
- **Механизм:** сравнивает текущие сигналы с предыдущими snapshot и помечает изменения.
- **Ценность:** удерживает конфиг актуальным.
- **Риски:** хранение snapshot.
- **Governance:** ограничить TTL, не коммитить.
- **Ц1:** «Каждый drfit — новая паника?»
- **Ц2:** «Нет, просто подсказка, что стоит пересканировать.»
- **Вердикт:** включить с TTL.

#### B10. Detector Health Telemetry
- **Механизм:** собирает статистику успехов/ошибок детекторов (локально) для developer dashboard.
- **Ценность:** повышает качество.
- **Риски:** нужно защищать приватность.
- **Governance:** только агрегированные данные, без источников.
- **Ц1:** «Снова скрытые метрики.»
- **Ц2:** «Без них не увидим, что сломалось.»
- **Вердикт:** включить, хранить агрегировано.

### Блок C. Руководство пользователю (10 идей)

#### C1. Insight Canvas Grid
- **Механизм:** основная таблица «Поле, Предложение, Уверенность, Reason Code» с inline редактированием.
- **Ценность:** вся информация на одном экране, нулевая когнитивная нагрузка.
- **Риски:** нужен аккуратный адаптивный layout.
- **Governance:** полностью совместимо.
- **Ц1:** «Таблица в терминале, серьёзно?»
- **Ц2:** «Да, если аккуратно и с клавиатурой.»
- **Вердикт:** включить как ядро UX.

#### C2. Progressive Disclosure Toggle
- **Механизм:** advanced детали открываются по `i`/`Enter`, по умолчанию скрыты.
- **Ценность:** не перегружает новичков.
- **Риски:** опытные пользователи могут искать детали.
- **Governance:** соответствует «минимум действий».
- **Ц1:** «Спрячем слишком глубоко — не найдут.»
- **Ц2:** «Подпишем подсказку, всё на месте.»
- **Вердикт:** включить.

#### C3. Confidence Signal Bar
- **Механизм:** верхний индикатор показывает уровень уверенности и шаги для повышения.
- **Ценность:** мгновенно поясняет статус intake.
- **Риски:** визуальный шум при узких терминалах.
- **Governance:** без ограничений.
- **Ц1:** «Бар? Мы тут не PowerPoint.»
- **Ц2:** «Маленький и текстовый — будет полезно.»
- **Вердикт:** включить, адаптировать к ширине.

#### C4. Microcopy Coach
- **Механизм:** короткие пояснения под каждым полем («обнаружено в package.json → scripts.dev»).
- **Ценность:** объясняет выводы без документации.
- **Риски:** много текста.
- **Governance:** важно для explainability.
- **Ц1:** «Под каждой строкой абзац?»
- **Ц2:** «Одна фраза — не трагедия.»
- **Вердикт:** включить.

#### C5. Undo/Redo Stack
- **Механизм:** `u` и `Shift+u` для отмены/повтора изменений.
- **Ценность:** убирает страх экспериментировать.
- **Риски:** усложняет внутреннее состояние.
- **Governance:** повышает доверие.
- **Ц1:** «Историю хранить? ещё память.»
- **Ц2:** «Зато никакой «потерянной» настройки.»
- **Вердикт:** включить.

#### C6. Field Locking with Soft Unlock
- **Механизм:** поля с high confidence заблокированы, но разблокируются по `Enter`.
- **Ценность:** предотвращает случайные правки.
- **Риски:** раздражение, если нужно часто править.
- **Governance:** требует понятного UX.
- **Ц1:** «Пользователь решит, что мы запретили править.»
- **Ц2:** «Добавим ясный hint: «нажмите Enter для редактирования»».
- **Вердикт:** включить.

#### C7. Golden Path Footer
- **Механизм:** нижняя панель показывает текущий шаг и следующее действие.
- **Ценность:** ориентирует, снижает когнитивную нагрузку.
- **Риски:** место в узких терминалах.
- **Governance:** соответствует цели.
- **Ц1:** «Footer нагружен.»
- **Ц2:** «Пусть адаптивно сворачивается.»
- **Вердикт:** включить.

#### C8. Inline Risk Alerts
- **Механизм:** поля с security/compliance риском помечаются алертом и ссылкой «почему».
- **Ценность:** вовремя предупреждает.
- **Риски:** избыток алертов.
- **Governance:** полезно для политики.
- **Ц1:** «Всё в красном — стресс.»
- **Ц2:** «Порог ≥ medium severity, иначе скрываем.»
- **Вердикт:** включить с порогом.

#### C9. Context Mode Switch (Single key)
- **Механизм:** `Ctrl+Space` переключает между таблицей и обзором.
- **Ценность:** быстрый навигатор.
- **Риски:** конфликт клавиш.
- **Governance:** без ограничений.
- **Ц1:** «Опять хоткеи, которые никто не помнит.»
- **Ц2:** «В подсказке покажем.»
- **Вердикт:** включить.

#### C10. Persona-aware Hints
- **Механизм:** на основе профиля (Developer, SecOps, Analyst) подсказки адаптируются.
- **Ценность:** релевантность.
- **Риски:** нужна опция выбора.
- **Governance:** конфигурация хранится локально.
- **Ц1:** «Персоны в терминале, серьёзно?»
- **Ц2:** «Если всё локально, почему нет.»
- **Вердикт:** включить с default=General.

### Блок D. Безопасность и соответствие (10 идей)

#### D1. Sandbox Consent Banner
- **Механизм:** перед запуском sandbox показывается баннер с ограничениями и кнопками `[Y] Запустить / [N] Пропустить`.
- **Ценность:** соблюдение политики исполнения кода.
- **Риски:** ещё один шаг.
- **Governance:** обязательное условие SecOps.
- **Ц1:** «Пользователь устал от баннеров.»
- **Ц2:** «Это цена безопасности.»
- **Вердикт:** включить.

#### D2. Manifest Write Shield
- **Механизм:** даже при предложении фикса UI не записывает файлы; выдаёт патч/команду.
- **Ценность:** соблюдение read-only.
- **Риски:** пользователю придётся делать шаг вручную.
- **Governance:** критически важно.
- **Ц1:** «Мы должны были сделать всё сами!»
- **Ц2:** «Но политика запрещает. Покажем команду — человек решит.»
- **Вердикт:** включить обязательно.

#### D3. Secret Scrubber
- **Механизм:** проверяет предложения `env` на наличие секретов, заменяет на placeholders.
- **Ценность:** предотвращает утечки.
- **Риски:** false positive/negative.
- **Governance:** соответствует security директивам.
- **Ц1:** «Заменим реальный токен — всё упадёт.»
- **Ц2:** «Покажем diff и спросим подтверждение.»
- **Вердикт:** включить.

#### D4. Policy Evidence Log
- **Механизм:** при нарушении правила записывает reason code и ссылку на политику.
- **Ценность:** аудит и ревью.
- **Риски:** рост логов.
- **Governance:** требуется для compliance.
- **Ц1:** «Логи никто не читает.»
- **Ц2:** «До первого инцидента. Потом спасибо скажут.»
- **Вердикт:** включить с TTL.

#### D5. Restricted Capability Warning
- **Механизм:** если MCP требует запрещённый egress, UI блокирует автоприменение.
- **Ценность:** предотвращает нарушения.
- **Риски:** нужно актуализировать список запрещённых capability.
- **Governance:** must-have.
- **Ц1:** «Половина MCP заблокирована.»
- **Ц2:** «Такова политика — и пользователи это должны видеть.»
- **Вердикт:** включить.

#### D6. Sandbox Resource Shield
- **Механизм:** лимитирует CPU, RAM, I/O при health-check.
- **Ценность:** защищает хост.
- **Риски:** конфигурация на разных платформах.
- **Governance:** требуется в policy.
- **Ц1:** «На Windows больно.»
- **Ц2:** «Применим job objects — решаемо.»
- **Вердикт:** включить.

#### D7. Signed Knowledge Packs
- **Механизм:** все детекторы/шаблоны подписаны Ed25519, проверяются при загрузке.
- **Ценность:** supply-chain защита.
- **Риски:** управление ключами.
- **Governance:** соответствует CODX supply-chain контролю.
- **Ц1:** «Сломаем ключ — и всё.»
- **Ц2:** «Поддерживаем ротацию — всё под контролем.»
- **Вердикт:** включить.

#### D8. Compliance Pre-flight Report
- **Механизм:** перед применением выводит список пройденных/проваленных проверок.
- **Ценность:** SecOps видит готовность.
- **Риски:** перегрузка текстом.
- **Governance:** соответствует контролю качества.
- **Ц1:** «Отчёт перед каждым применением?»
- **Ц2:** «Да, но краткий на 3 строки.»
- **Вердикт:** включить (краткий формат).

#### D9. Consent Audit Trail
- **Механизм:** фиксирует факт согласия/отказа на sandbox и debug действия.
- **Ценность:** юридическая защита.
- **Риски:** управление логами.
- **Governance:** критично для compliance.
- **Ц1:** «Согласия храним сутки? зачем?»
- **Ц2:** «Чтобы доказать, что не запускали без спроса.»
- **Вердикт:** включить.

#### D10. Policy Update Notifier
- **Механизм:** если политика изменилась, UI предупреждает пользователя.
- **Ценность:** избегает сюрпризов.
- **Риски:** нужно знать версию политики.
- **Governance:** важный элемент.
- **Ц1:** «Снова уведомления?»
- **Ц2:** «Лучше предупредить, чем заблокировать внезапно.»
- **Вердикт:** включить.

### Блок E. Отладка и поддержка (10 идей)

#### E1. Debug Checklist Orchestrator
- **Механизм:** автоматический сценарий проверки (файлы, зависимости, окружение) с reason codes.
- **Ценность:** 80% ошибок решаются сразу.
- **Риски:** поддержка сценариев.
- **Governance:** не нарушает read-only (всё симулятивно).
- **Ц1:** «Опять чеклисты, которые никто не читает.»
- **Ц2:** «Если чеклист чинит — будут счастливы.»
- **Вердикт:** включить.

#### E2. Dry-Run Simulator (No Execution)
- **Механизм:** симулирует запуск команды (разбор аргументов, проверка файлов) без исполнения.
- **Ценность:** раннее выявление ошибок.
- **Риски:** не поймает runtime ошибки.
- **Governance:** безопасно.
- **Ц1:** «Симулятор покажет «всё ок», а потом упадём.»
- **Ц2:** «Но проверим базовые вещи до sandbox.»
- **Вердикт:** включить.

#### E3. Live Error Annotation
- **Механизм:** поясняет stderr health-check (подсветка ключевых слов, ссылки на FAQ).
- **Ценность:** ускоряет устранение.
- **Риски:** требует словаря ошибок.
- **Governance:** безопасно.
- **Ц1:** «Разметка терминала — боль.»
- **Ц2:** «Импортируем словарь — всё будет аккуратно.»
- **Вердикт:** включить.

#### E4. Auto-Debug Command Export
- **Механизм:** генерирует команду для ручного запуска (с sandbox флагами).
- **Ценность:** пользователи воспроизводят проблему.
- **Риски:** команда может быть длинной.
- **Governance:** не нарушает политику.
- **Ц1:** «Кому нужен ещё один one-liner?»
- **Ц2:** «Тем, кто пишет баг-репорты.»
- **Вердикт:** включить.

#### E5. Failure Pattern Library
- **Механизм:** сопоставляет ошибки с шаблонами (например, `EADDRINUSE`) и даёт точный совет.
- **Ценность:** моментальная помощь.
- **Риски:** поддержка библиотеки.
- **Governance:** безопасно.
- **Ц1:** «Поддерживать словарь — кошмар.»
- **Ц2:** «Ротация через knowledge packs решает.»
- **Вердикт:** включить.

#### E6. Replay Sandbox Button
- **Механизм:** повторяет последний health-check в sandbox.
- **Ценность:** быстрый ре-тест после фикса.
- **Риски:** может запускаться часто.
- **Governance:** требует повторного consent? фиксируем «до 10 мин после согласия не спрашиваем».
- **Ц1:** «Опять запускаем чужой код.»
- **Ц2:** «Консенсус есть, sandbox ограничен — безопасно.»
- **Вердикт:** включить с limited window.

#### E7. Attach Logs Option
- **Механизм:** создаёт локальный архив логов для отправки в поддержку.
- **Ценность:** ускоряет помощь.
- **Риски:** может содержать чувствительные данные.
- **Governance:** требовать confirm и подсветить содержимое.
- **Ц1:** «Собираем логи — рискуем secrets.»
- **Ц2:** «Покажем preview перед сохранением.»
- **Вердикт:** включить (opt-in).

#### E8. Guided Manual Fix Wizard
- **Механизм:** пошаговое руководство при низком confidence (список вопросов).
- **Ценность:** структурированный fallback.
- **Риски:** увеличивает шаги.
- **Governance:** соответствует zero-load (опционально).
- **Ц1:** «Снова wizard в wizard.»
- **Ц2:** «Лучше, чем пустой экран.»
- **Вердикт:** включить при confidence <0.4.

#### E9. Root Cause Timeline
- **Механизм:** визуализирует последовательность проверок и их статусы.
- **Ценность:** позволяет увидеть, где упали.
- **Риски:** визуальный шум.
- **Governance:** безопасно.
- **Ц1:** «Таймлайн в терминале? давайте сразу графики.»
- **Ц2:** «4 строки — не проблема.»
- **Вердикт:** включить в debug view.

#### E10. Postmortem Template Export
- **Механизм:** создаёт markdown для внутреннего постмортема.
- **Ценность:** стандартизирует анализ ошибок.
- **Риски:** дополнительная функция.
- **Governance:** поддержка процессов.
- **Ц1:** «Постмортем за пользователя? лишнее.»
- **Ц2:** «Если ошибка серьёзная, шаблон экономит часы.»
- **Вердикт:** включить (opt-in).

### Блок F. Производительность и кеширование (10 идей)

#### F1. Signal Cache Layer
- **Механизм:** кеш результатов детекторов по ключу (path, mtime, detector_version).
- **Ценность:** повторные сканы мгновенны.
- **Риски:** устаревание кеша.
- **Governance:** TTL=15 мин.
- **Ц1:** «Кеш устареет, и мы дадим старый ответ.»
- **Ц2:** «С TTL и invalidation проблемы не будет.»
- **Вердикт:** включить.

#### F2. Warmup Scheduler
- **Механизм:** предварительно подгружает популярные детекторы при старте CLI/TUI.
- **Ценность:** уменьшает холодные задержки.
- **Риски:** лишний стартовый overhead.
- **Governance:** безопасно.
- **Ц1:** «Старт будет медленнее.»
- **Ц2:** «Зато первый intake — быстрее. Компромисс.»
- **Вердикт:** включить (lazy warmup).

#### F3. Adaptive Throttling
- **Механизм:** если диск медленный, снижает параллелизм.
- **Ценность:** стабильность.
- **Риски:** сложнее отладить.
- **Governance:** без ограничений.
- **Ц1:** «Мы теперь ещё и профилируем диск?»
- **Ц2:** «Лучше мягко замедлить, чем зависнуть.»
- **Вердикт:** включить.

#### F4. Incremental Archive Reader
- **Механизм:** читает архив без полной распаковки (streaming).
- **Ценность:** экономия времени и места.
- **Риски:** сложность реализации.
- **Governance:** read-only.
- **Ц1:** «Сложно, но элегантно.»
- **Ц2:** «Сократит I/O — стоит того.»
- **Вердикт:** включить.

#### F5. Detector Profiling Hooks
- **Механизм:** логирует время выполнения детекторов для оптимизации.
- **Ценность:** помогает DevOps.
- **Риски:** дополнительные логи.
- **Governance:** локально, TTL.
- **Ц1:** «Больше логов.»
- **Ц2:** «Но без них мы не знаем bottleneck.»
- **Вердикт:** включить.

#### F6. Parallel FS Scanner
- **Механизм:** параллельное чтение файлов с учётом ограничений I/O.
- **Ценность:** ускоряет анализ больших каталогов.
- **Риски:** может перегрузить HDD.
- **Governance:** адаптивный контроль с F3.
- **Ц1:** «Балансировать параллелизм сложно.»
- **Ц2:** «С heuristic – manageable.»
- **Вердикт:** включить.

#### F7. Cache Health Monitor
- **Механизм:** проверяет % попаданий, предупреждает о деградации.
- **Ценность:** поддержка производительности.
- **Риски:** мониторинг метрик.
- **Governance:** локально.
- **Ц1:** «Мониторинг кеша — роскошь?»
- **Ц2:** «Нет, иначе не узнаем, что всё сломалось.»
- **Вердикт:** включить.

#### F8. Low-end Mode Toggle
- **Механизм:** снижает визуальные эффекты, выключает дополнительные подсказки для медленных машин.
- **Ценность:** пригодно для старых систем.
- **Риски:** удваивает сценарии тестирования.
- **Governance:** UX компромисс.
- **Ц1:** «Поддерживать два режима?»
- **Ц2:** «Это лишь набор флагов, не отдельный UI.»
- **Вердикт:** включить.

#### F9. Telemetry-free Benchmarking
- **Механизм:** локально измеряет время intake и health-check; выводит статистику пользователю.
- **Ценность:** прозрачность производительности.
- **Риски:** лишние данные.
- **Governance:** не отправляем наружу.
- **Ц1:** «Кому нужна статистика?»
- **Ц2:** «Когда медленно — все спрашивают «почему?»»
- **Вердикт:** включить.

#### F10. Prefetch Advisory
- **Механизм:** на основе intent предлагает подготовить зависимости (npm install) до health-check.
- **Ценность:** снижает ошибки времени выполнения.
- **Риски:** может дублировать работу.
- **Governance:** даём только инструкцию, не выполняем.
- **Ц1:** «Опять человек должен что-то делать.»
- **Ц2:** «Но лучше знать заранее, чем падать позже.»
- **Вердикт:** включить.

### Блок G. Коллаборация и ревью (10 идей)

#### G1. Reviewer Snapshot Export
- **Механизм:** создаёт Markdown + JSON с reason codes и диффом.
- **Ценность:** ревью занимает <5 мин.
- **Риски:** хранение файла.
- **Governance:** локально, TTL.
- **Ц1:** «Ещё файлы для ревью?»
- **Ц2:** «Да, но это экономит часы.»
- **Вердикт:** включить.

#### G2. Collaboration Comment Mode
- **Механизм:** позволяет оставить локальный комментарий к предложению (не коммитится).
- **Ценность:** команды обсуждают конфиг.
- **Риски:** хранение комментариев.
- **Governance:** TTL=24 ч, ZDR ready.
- **Ц1:** «Комментарии исчезнут — люди рассердятся.»
- **Ц2:** «Сообщим про TTL. Это заметки, не система трекинга.»
- **Вердикт:** включить.

#### G3. Change Justification Summary
- **Механизм:** при применении генерирует короткое обоснование («команда найдена в…»).
- **Ценность:** ревьюеру понятна логика.
- **Риски:** поддержка шаблона.
- **Governance:** полезно.
- **Ц1:** «Опять тексты от робота.»
- **Ц2:** «Зато consistent и быстрый обзор.»
- **Вердикт:** включить.

#### G4. Intake Session Transcript
- **Механизм:** лог шагов (анализ, изменения, решения) в формате TLDR.
- **Ценность:** пересматриваем процесс.
- **Риски:** нужно чистить.
- **Governance:** TTL, не коммитить.
- **Ц1:** «Лог и так огромный.»
- **Ц2:** «Сводка всё равно компактная.»
- **Вердикт:** включить.

#### G5. Reviewer Diff Mode in TUI
- **Механизм:** отдельный режим показывает изменения конфигов как diff.
- **Ценность:** ревью прямо в TUI.
- **Риски:** больше UI.
- **Governance:** безопасно.
- **Ц1:** «Diff в терминале – воспоминания git.»
- **Ц2:** «Люди привыкли. Ничего страшного.»
- **Вердикт:** включить.

#### G6. Approval Checklist Alignment
- **Механизм:** связывает intake данные с корпоративным approval checklist.
- **Ценность:** ревьюер отмечает выполнение критериев.
- **Риски:** синхронизация checklist.
- **Governance:** соответствует policy.
- **Ц1:** «Ещё один чеклист?»
- **Ц2:** «Но теперь заполнен автоматически.»
- **Вердикт:** включить.

#### G7. Export to PR Template
- **Механизм:** генерирует текст для PR/issue с ключевыми фактами.
- **Ценность:** ускоряет коммуникацию.
- **Риски:** поддержка шаблонов.
- **Governance:** безопасно.
- **Ц1:** «Мы теперь за людей пишем PR?»
- **Ц2:** «Если они хотят — нажмут кнопку.»
- **Вердикт:** включить.

#### G8. Shared Intake Patterns Catalog
- **Механизм:** хранит успешные конфигурации внутри команды (по согласию).
- **Ценность:** reuse.
- **Риски:** безопасность.
- **Governance:** требуется opt-in и подписи.
- **Ц1:** «Поделимся конфигом — поделимся секретами.»
- **Ц2:** «Секреты заменены placeholders, всё хорошо.»
- **Вердикт:** включить с governance.

#### G9. Reviewer Feedback Loop
- **Механизм:** после ревью система предлагает отправить оценку качества рекомендаций.
- **Ценность:** улучшение алгоритмов.
- **Риски:** дополнительный шаг.
- **Governance:** опционально.
- **Ц1:** «Оценочки… никто не любит опросы.»
- **Ц2:** «Раз в неделю соберём сигнал — норм.»
- **Вердикт:** включить (rare prompt).

#### G10. Multi-profile Export
- **Механизм:** экспорт конфигурации в несколько форматов (JSON, YAML, Markdown) одним нажатием.
- **Ценность:** облегчает интеграцию.
- **Риски:** поддержка конверторов.
- **Governance:** безопасно.
- **Ц1:** «Зачем 3 формата?»
- **Ц2:** «Чтобы не писать преобразователь вручную.»
- **Вердикт:** включить.

### Блок H. Доступность и интернационализация (10 идей)

#### H1. Text-Only Mirror View
- **Механизм:** отдельный текстовый поток (без псевдографики) для screen reader.
- **Ценность:** полная доступность.
- **Риски:** поддержка синхронизации.
- **Governance:** необходимо для Accessibility.
- **Ц1:** «Два отображения — двойная работа.»
- **Ц2:** «Но это единственный способ удовлетворить SR.»
- **Вердикт:** включить.

#### H2. AccessKit Bridge Layer
- **Механизм:** абстракция, транслирующая структуру UI в AccessKit.
- **Ценность:** нативная поддержка SR.
- **Риски:** требуется разработка.
- **Governance:** aligns с политикой доступности.
- **Ц1:** «Реализация сложна.»
- **Ц2:** «Но это инвестиция в устойчивость.»
- **Вердикт:** включить (готовить proof-of-concept).

#### H3. i18n Key Map (`mcp_atlas.*`)
- **Механизм:** все строки переводимы через централизованный словарь.
- **Ценность:** интернационализация.
- **Риски:** поддержка переводов.
- **Governance:** соответствует глобальным требованиям.
- **Ц1:** «Переводы никогда не закончишь.»
- **Ц2:** «Хотя бы архитектуру заложим.»
- **Вердикт:** включить.

#### H4. High-Contrast Theme Pack
- **Механизм:** темы Dark/Light/HighContrast с контрастом ≥7:1.
- **Ценность:** доступность.
- **Риски:** поддержка кастомных цветов.
- **Governance:** Accessibility.
- **Ц1:** «Темы – головная боль.»
- **Ц2:** «Лучше 3 поддерживаемых, чем бесконечный кастом.»
- **Вердикт:** включить.

#### H5. Keyboard-First Navigation Map
- **Механизм:** клавишная карта доступна по `?`, описывает все действия.
- **Ценность:** обучает клавиатурной работе.
- **Риски:** нужно обновлять при изменениях.
- **Governance:** требование.
- **Ц1:** «Карта устареет через неделю.»
- **Ц2:** «Покрываем тестами — не забудем.»
- **Вердикт:** включить.

#### H6. VoiceOver/NVDA Test Harness
- **Механизм:** автоматизированные тесты через сценарии screen reader.
- **Ценность:** гарантирует доступность.
- **Риски:** поддержка инфраструктуры.
- **Governance:** must.
- **Ц1:** «Настроить NVDA pipeline — кошмар.»
- **Ц2:** «Но иначе не проверим.»
- **Вердикт:** включить.

#### H7. Language Fallback Plan
- **Механизм:** если перевода нет, показывает английский и предупреждает.
- **Ценность:** предотвращает пустые строки.
- **Риски:** нужно мониторить.
- **Governance:** соответствует i18n.
- **Ц1:** «Алёрт при каждом пропущенном ключе.»
- **Ц2:** «Это Motivation для Localization.»
- **Вердикт:** включить.

#### H8. Screen Reader Friendly Tables
- **Механизм:** таблица Insight Canvas имеет ARIA-упорядоченные заголовки и описания.
- **Ценность:** доступность.
- **Риски:** реализация.
- **Governance:** требуется.
- **Ц1:** «ARIA в терминале?»
- **Ц2:** «С текстовым зеркалом — возможно.»
- **Вердикт:** включить.

#### H9. Localization QA Checklist
- **Механизм:** контрольный список (правильный род, длина, placeholders).
- **Ценность:** качество локализации.
- **Риски:** ручная поддержка.
- **Governance:** align.
- **Ц1:** «Чеклистов и так много.»
- **Ц2:** «Но без него локализация развалится.»
- **Вердикт:** включить.

#### H10. Accessible Error Alerts
- **Механизм:** ошибки озвучиваются (text-only channel) и имеют короткие резюме.
- **Ценность:** screen reader не пропускает важное.
- **Риски:** нужно избегать спама.
- **Governance:** must.
- **Ц1:** «Ошибки будут звучать вечно.»
- **Ц2:** «Только критические. Остальные в лог.»
- **Вердикт:** включить.

### Блок I. Автоматизация и интеграции (10 идей)

#### I1. API Hooks for CI
- **Механизм:** CLI флаг `--export-intake` для CI pipeline.
- **Ценность:** автоматизация конфигов.
- **Риски:** misuse.
- **Governance:** безопасно при подписи.
- **Ц1:** «Теперb CI будет «настраивать» MCP?»
- **Ц2:** «Нет, только соберёт данные для ревьюеров.»
- **Вердикт:** включить.

#### I2. MCP Registry Sync
- **Механизм:** синхронизация с корпоративным каталогом (read-only) для подсказок.
- **Ценность:** reuse.
- **Риски:** политика доступа.
- **Governance:** только при одобрении.
- **Ц1:** «Подключим реестр — потянем приватные данные.»
- **Ц2:** «Если read-only и подписано — ok.»
- **Вердикт:** включить условно (enterprise).

#### I3. CLI Scriptability Layer
- **Механизм:** JSON-RPC API для автоматизации intake.
- **Ценность:** интеграция в tooling.
- **Риски:** сложность тестирования.
- **Governance:** требует auth и rate limits.
- **Ц1:** «Мы делаем API для всего?»
- **Ц2:** «Да, чтобы DevOps не парсили stdout.»
- **Вердикт:** включить по мере готовности.

#### I4. Issue Tracker Integration Hook
- **Механизм:** экспорт error report в JIRA/GitHub (через CLI команду).
- **Ценность:** ускоряет эскалацию.
- **Риски:** сеть (разрешение?).
- **Governance:** только в режимах, где сеть разрешена.
- **Ц1:** «Теперь intake ходит в JIRA? опасно.»
- **Ц2:** «Только по explicit команде и конфигу.»
- **Вердикт:** включить opt-in.

#### I5. Knowledge Pack Auto-Update Scheduler
- **Механизм:** обновления паков через Trusted Pipeline с подписью.
- **Ценность:** всегда свежие детекторы.
- **Риски:** нужно handle rollback.
- **Governance:** полностью подпадает под supply-chain контроль.
- **Ц1:** «Автообновления — риск.»
- **Ц2:** «С подписью и rollback всё контролируем.»
- **Вердикт:** включить.

#### I6. Policy Sync Agent
- **Механизм:** периодически обновляет локальный policy cache из центра.
- **Ценность:** актуальные правила.
- **Риски:** синхронизация.
- **Governance:** must при enterprise.
- **Ц1:** «Ещё один агент.»
- **Ц2:** «Лёгкий cron job. Стоит того.»
- **Вердикт:** включить.

#### I7. Snapshot Publishing CLI
- **Механизм:** `codex mcp snapshot --share` (создаёт подписанный пакет для передачи).
- **Ценность:** обмен конфигами.
- **Риски:** премодерация.
- **Governance:** нужно approval.
- **Ц1:** «Раздаём конфиги — риск.»
- **Ц2:** «Только по разрешению, и с placeholders.»
- **Вердикт:** включить (enterprise gated).

#### I8. Metrics Bridge (local)
- **Механизм:** публикует локальные метрики intake (latency, success rate) в Prometheus endpoint (опционально).
- **Ценность:** SRE наблюдает тренды.
- **Риски:** поддержка.
- **Governance:** локально, без PII.
- **Ц1:** «Prometheus в CLI? серьёзно?»
- **Ц2:** «Опция для продвинутых команд.»
- **Вердикт:** включить (off by default).

#### I9. Config Drift Webhook
- **Механизм:** отправляет уведомление (локально) при выявленном дрейфе.
- **Ценность:** автоматический контроль.
- **Риски:** сеть запрещена ⇒ только локальные интеграции.
- **Governance:** ограничить единичным скриптом.
- **Ц1:** «Webhook в безсетевой политике?»
- **Ц2:** «Можно запускать локальный action (скрипт).»
- **Вердикт:** включить как локальный hook.

#### I10. SSO-aware Intake Profiles
- **Механизм:** адаптирует подсказки auth под текущую SSO-политику.
- **Ценность:** меньше ошибок с auth.
- **Риски:** нужно интегрироваться с Auth Manager.
- **Governance:** в рамках политики.
- **Ц1:** «Опять лазим в SSO данные.»
- **Ц2:** «Через существующий AuthManager — всё легитимно.»
- **Вердикт:** включить.

### Блок J. Надёжность и мониторинг (10 идей)

#### J1. Intake Health Dashboard (локально)
- **Механизм:** TUI-домашний экран со статистикой успешных/провальных intake.
- **Ценность:** видимость состояния.
- **Риски:** место и поддержка.
- **Governance:** локально.
- **Ц1:** «Мы строим табло?»
- **Ц2:** «Мини-график поможет DevOps.»
- **Вердикт:** включить в optional режим.

#### J2. Heartbeat Self-test
- **Механизм:** периодический self-test детекторов (на встроенных fixtures).
- **Ценность:** раннее обнаружение регрессий.
- **Риски:** время выполнения.
- **Governance:** безопасно.
- **Ц1:** «Самотесты будут мешать?»
- **Ц2:** «Запускать при старте раз в сутки.»
- **Вердикт:** включить.

#### J3. Error Budget Tracker
- **Механизм:** считает допустимый процент неуспешных intake по целевым метрикам.
- **Ценность:** управление качеством.
- **Риски:** дополнительная аналитика.
- **Governance:** соответствует SRE практике.
- **Ц1:** «Error budget — термин для сервисов, а не CLI.»
- **Ц2:** «Но процесс intake — тоже сервис.»
- **Вердикт:** включить (в отчётах).

#### J4. Stability Guard (feature flags)
- **Механизм:** каждое крупное улучшение gated feature-flagом с rollout.
- **Ценность:** безопасные релизы.
- **Риски:** сложность управления флагами.
- **Governance:** соответствует release стратегии.
- **Ц1:** «Флаги плодятся.»
- **Ц2:** «Но спасают от отката продакшна.»
- **Вердикт:** включить.

#### J5. Crash Recovery Flow
- **Механизм:** при сбое wizard автоматически восстанавливает состояние.
- **Ценность:** не теряем прогресс.
- **Риски:** требует журнал изменений.
- **Governance:** локально.
- **Ц1:** «Журнал → ещё один файл.»
- **Ц2:** «Маленький JSON, TTL 1 час.»
- **Вердикт:** включить.

#### J6. Support Mode Toggle
- **Механизм:** активирует расширенное логирование по запросу поддержки.
- **Ценность:** диагностика без перепаковки.
- **Риски:** может собирать лишнее.
- **Governance:** включается вручную, auto-off.
- **Ц1:** «Люди забудут выключить.»
- **Ц2:** «Auto-off после 30 мин.»
- **Вердикт:** включить.

#### J7. Incident Hook Integration
- **Механизм:** при критической ошибке вызывает локальный скрипт/оповещение.
- **Ценность:** быстрая реакция.
- **Риски:** запуск сторонних команд.
- **Governance:** нужен allowlist.
- **Ц1:** «Скрипты пользователя — риск.»
- **Ц2:** «Запрета нет, если allowlist конфигурируемый.»
- **Вердикт:** включить (allowlist + подтверждение).

#### J8. Auto-Rollback Knowledge Pack
- **Механизм:** при неудачном обновлении детекторов откатывает предыдущую версию.
- **Ценность:** устойчивость.
- **Риски:** управление версиями.
- **Governance:** must.
- **Ц1:** «Rollback сложно.»
- **Ц2:** «Но без него простои.»
- **Вердикт:** включить.

#### J9. SLA Guardrail Alerts
- **Механизм:** если latency или success rate выходят за метрики, уведомляет команду.
- **Ценность:** контроль качества.
- **Риски:** нужно место для уведомления.
- **Governance:** локально.
- **Ц1:** «Уведомления замучают.»
- **Ц2:** «Только при реальной деградации.»
- **Вердикт:** включить.

#### J10. Adoption Telemetry (opt-in)
- **Механизм:** по согласию пользователя отправляет агрегированные показатели в OpenAI для улучшений.
- **Ценность:** статистика использования.
- **Риски:** privacy.
- **Governance:** только opt-in, анонимно.
- **Ц1:** «Отправлять метрики — политика?»
- **Ц2:** «Только по явному согласию — compliant.»
- **Вердикт:** включить (opt-in).

## 4. Консолидация выводов
- **Ключевые элементы** (обязательные для MVP): Insight Canvas, Adaptive Source Parser, Weighted Confidence, Debug Checklist, Sandbox Consent Banner, Manifest Write Shield, Secret Scrubber, Signal Cache, Reviewer Snapshot, Text-only Mirror View, Sandbox Resource Shield.
- **Опциональные (Phase 2+)**: Persona hints, Collaboration comments, Prometheus endpoint, Issue tracker hook, Adoption telemetry.
- **Отклонённые**: любые, требующие несанкционированного egress или дублирующие UI (например, drag&drop зоны, голосовой ввод) — исключены.

## 5. Финальная архитектура: MCP Atlas Autopilot v2

### 5.1 Логический поток
1. **Source Context**
   - Строка ввода с макросами и подсказками.
   - Source Preview Strip + Policy Guard.
   - При подтверждении создаётся fingerprint и запускается анализ.

2. **Insight Canvas**
   - Таблица предложений, Microcopy, Confidence Bar, Risk Alerts.
   - Inline edit, Undo/Redo, Field Locking.
   - Advanced details через progressive disclosure.

3. **Confirm Capsule**
   - Сводка ключевых полей, Compliance Report, Change Justification.
   - Reviewer Snapshot и Export.

4. **Optional Activation**
   - Sandbox Consent Banner → Resource Shield → Health-check (opt-in).
   - Debug Checklist Orchestrator, Live Error Annotation, Replay Sandbox.

### 5.2 Слой безопасности
- Sandbox Runner (bubblewrap/nsjail/job object) с общим интерфейсом.
- Consent Audit Trail, Policy Evidence Log, Secret Scrubber.
- Signed knowledge packs и auto-rollback.

### 5.3 Слой производительности
- Signal Cache + Warmup Scheduler + Adaptive Throttling.
- Parallel FS Scanner с guardrails.
- Performance metrics локально (telemetry-free).

### 5.4 Слой доступности
- Text-only Mirror View + AccessKit Bridge.
- High-contrast темы, клавишная карта, screen reader тесты.

### 5.5 Слой коллаборации
- Reviewer Snapshot Export, Diff Mode, Approval Checklist Alignment.
- Collaboration comments с TTL, PR Template, Multi-format export.

## 6. Реализационный план
| Фаза | Длительность | Основные deliverables | Зависимости |
| --- | --- | --- | --- |
| **Foundation Sprint** | 3 недели | State machine intake, Adaptive Parser, Signal Cache, Reason Codes каталог, Consent Audit Trail | Требует подписи knowledge packs |
| **Insight Sprint** | 3 недели | Insight Canvas UI, Progressive Disclosure, Confidence Bar, Field Locking, Undo/Redo | Foundation завершён |
| **Safety Sprint** | 2 недели | Sandbox Runner абстракция, Consent Banner, Resource Shield, Secret Scrubber, Manifest Shield | Определены платформенные механизмы |
| **Support Sprint** | 2 недели | Debug Checklist, Live Annotation, Failure Library, Replay Sandbox, Postmortem Export | Safety завершён |
| **Accessibility & Intl Sprint** | 3 недели | Text-only Mirror, AccessKit Bridge, i18n ключи, темы, SR harness | Insight + Support |
| **Collaboration Sprint** | 2 недели | Reviewer Snapshot, Diff Mode, PR Template, Comments, Checklist Alignment | Foundation + Insight |
| **Performance & Monitoring Sprint** | 2 недели | Warmup Scheduler, Adaptive Throttling, FS Scanner, Cache monitor, Error budget tracker | Foundation |
| **Integration & Governance Sprint** | 2 недели | Policy sync, Knowledge pack auto-update, SSO-aware hints, Metrics bridge (opt-in) | Safety + Collaboration |
| **Stabilization & Launch** | 2 недели | Бенчмарки, Accessibility тесты, Docs, Release notes, Feature flags rollout | Все предыдущие |

## 7. Контроль качества
- **Unit Tests:** детекторы, scoring, macros, secret scrubber, undo stack, sandbox adapters.
- **Integration Tests:** `codex mcp wizard --source <fixture>` для Node, Python, Binary, ошибок, policy нарушений.
- **Snapshot Tests:** Insight Canvas (разные ширины), Confirm Capsule, Debug экран.
- **Performance Tests:** Criterion бенчмарки на 50/200 файлов, zip archives.
- **Security Review:** sandbox ограничения, path traversal, secret detection.
- **Compliance Review:** политика исполнения, consent logging, knowledge pack подписи.
- **Accessibility Review:** VoiceOver/NVDA, High contrast, клавиатурная навигация.
- **Pilot:** 3 команды проводят intake без ручных правок; метрики времени и удовлетворённости.

## 8. Метрики успеха
- **Intake Success Rate:** ≥95% без ручного редактирования.
- **Average Time-to-config:** медиана ≤ 90 сек; p95 ≤ 180 сек.
- **Debug Resolution Rate:** ≥80% проблем решаются через checklist.
- **Sandbox Adoption:** ≥70% соглашаются на Optional Activation.
- **Policy Compliance:** 100% нарушений фиксируются и блокируются.
- **Accessibility Score:** ≥ 95% задач выполняются screen reader пользователем в UX-тесте.
- **Review Effort:** среднее время ревью ≤ 5 мин.

## 9. Соответствие корпоративным политикам OpenAI
- **Security & Compliance:** sandbox consent, resource shield, secret scrubber, policy evidence log, signed knowledge packs.
- **Zero Data Retention:** TTL для fingerprint, snapshot, логов ≤ 24 ч; opt-in для любых внешних метрик.
- **Accessibility:** text-only mirror, AccessKit bridge, high-contrast themes, automated SR тесты.
- **Supply Chain:** knowledge packs и policy sync проходят через Trusted Pipeline.
- **Approval Governance:** feature flags, consent audit, reviewer snapshots интегрируются с текущей approval системой Codex CLI.

## 10. Следующие шаги
1. Провести архитектурный sign-off с владельцами CLI/TUI, SecOps, Accessibility, Compliance.
2. Утвердить ресурсный план по спринтам; назначить ответственных (Core, UI, Security, Accessibility, Tooling).
3. Подготовить fixtures и policy mocks для Foundation Sprint.
4. Специфицировать sandbox поддержка на каждой платформе (bubblewrap/nsjail/job object) и план доставки бинарий.
5. Организовать UX-исследование с 5 пользователями (DevOps, Data Scientist, SecOps) по прототипу Insight Canvas.
6. Настроить Trusted Pipeline подписи для knowledge packs и reason code каталога.
7. Подготовить документацию и обучающие материалы (Quickstart, Debug guide, Compliance checklist).

## 11. Приложения
- **Приложение A:** Каталог reason codes (подготовить в отдельном файле `docs/mcp/reasons.md`).
- **Приложение B:** Шаблон sandbox consent.
- **Приложение C:** Пример Reviewer Snapshot.
- **Приложение D:** Accessibility test checklist.

Документ служит формальным ориентиром для дальнейшей реализации «MCP Atlas Autopilot v2» — системы настройки MCP-серверов с революционным UX, строгой безопасностью и нулевой когнитивной нагрузкой для всех участников процесса.
